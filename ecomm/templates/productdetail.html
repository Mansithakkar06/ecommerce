{% extends "base.html" %}
{% block title %}{{product.title}}{% endblock title %}{{product.title}}

{% block content %}

{% if messages %}
<script src="//cdn.jsdelivr.net/npm/alertifyjs@1.14.0/build/alertify.min.js"></script>
<script> alertify.set('notifier', 'position', 'top-right');
  alertify.success("product added successfully");
</script>

{% endif %}
<div class="container">
    <h3>Product: {{product.title}}</h3>
    <div class="row">
        <div class="col-md-6">
            <img src="{{product.image.url}}" alt="image" class="img-fluid" height="400px" width="400px">
        </div>
        <div class="col-md-6">
            <h4>{{product.title}} (viewed {{product.view_count}} times)</h4>
            <hr>
            <h5>Category : {{product.category}}</h5>
            <h4><del>Rs. {{product.marked_price}}.00</del></h4>
            <h4>Rs. {{product.selling_price}}.00</h4>
            <hr>
            <p class="text-primary">Warranty : {{product.warranty}}</p>
            <p class="text-primary">Return Policy : {{product.return_policy}}</p>
            <hr>
            <p>{{product.description}}</p>
            {% comment %} <a href="{% url 'ecomm:addtocart' product.id %}" class="btn btn-success" onclick="alertmsg()">Add to cart</a> {% endcomment %}
            <!-- <form action="" method="POST">
                <button class="btn btn-warning" type="submit">Buy Now</button>    
            </form> -->
            <form action="" method="post" style="display: contents;">
                {% csrf_token %}
                <input hidden type="text" value="{{product.id}}" name="pid">
                <button class="btn btn-success" type="submit">Add to cart</button>
            </form>
            
            <a href="{% url 'ecomm:buynow' product.id %}" class="btn btn-warning">Buy Now</a>
            <!--<a pid={{product.id}} class="minus-wishlist btn btn-danger shadow px-5 py-2 ms-4"><i class="fa fa-heart" style="color:orange"></i></a>-->

             <!-- Add to Favorites Button -->
             <form id="favoriteForm" method="post" action="{% url 'ecomm:toggle_favorite' %}">
                {% csrf_token %}
                <input type="hidden" name="product_id" value="{{ product.id }}">
                <button type="submit" id="favoriteButton" class="btn btn-danger">
                    {% if is_favorite %}
                        Remove from Favorites
                    {% else %}
                        Add to Favorites
                    {% endif %}
                </button>
            </form>
        </div>
    </div>
</div>

<script>
    const form = document.getElementById('favoriteForm');
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        fetch(form.action, {
            method: 'POST',
            headers: {
                'X-CSRFToken': form.querySelector('input[name=csrfmiddlewaretoken]').value,
            },
            body: new FormData(form),
        }).then(response => response.json())
          .then(data => {
              alert(data.message);
              location.reload(); // Refresh the page to update the button text
          });
    });
</script>
{% endblock content %}